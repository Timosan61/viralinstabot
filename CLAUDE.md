# Проект: Viral Instagram Bot

## Описание
Telegram бот для анализа вирусных Instagram Reels с использованием Apify API.

## Важные правила для Claude

### 1. После изменений и перезапуска бота
**ВСЕГДА** переходи в режим мониторинга логов после:
- Внесения изменений в код
- Перезапуска бота
- Обновления конфигурации
- Исправления ошибок

Команда для мониторинга:
```bash
tail -f bot.log
```

### 2. Проверка работоспособности
При мониторинге обращай внимание на:
- Успешный запуск: "Bot started successfully"
- Обработка запросов: "Update id=XXX is handled"
- Ошибки: "ERROR" в логах
- Превышение лимитов: "limit exceeded"
- Работу rate limiter и monthly limiter

### 3. Текущая конфигурация
- **Apify Token**: задается через переменную окружения APIFY_API_TOKEN
- **Дневной лимит**: 10 запросов за 24 часа
- **Месячный лимит**: 10 запросов в месяц
- **Размер выборки**: максимум 10 Reels (варианты: 5, 7, 10)
- **Бот**: @viralanalyzer_bot

### 4. Структура проекта
```
/home/coder/Desktop/2202/Viralinstabot/
├── src/
│   ├── bot/
│   │   ├── handlers_v2.py    # Обработчики команд
│   │   ├── keyboards_v2.py    # Клавиатуры
│   │   └── states_v2.py       # FSM состояния
│   ├── services/
│   │   ├── apify_direct.py    # Прямые API запросы к Apify
│   │   ├── rate_limiter.py    # Дневной лимит
│   │   └── monthly_limiter.py # Месячный лимит
│   └── storage/
│       └── sqlite.py          # База данных
├── .env                       # Конфигурация
├── run.py                     # Точка входа
└── bot.log                    # Логи бота
```

### 5. Команды управления
```bash
# Запуск бота
nohup python3 run.py > bot.log 2>&1 &

# Остановка бота
pkill -f "python3 run.py"

# Мониторинг логов
tail -f bot.log

# Интерактивная панель
./bot_control.sh

# Установка как сервис
sudo ./install_service.sh
```

### 6. Типичные проблемы и решения
- **"Превышен месячный лимит"** - проверить monthly_limiter.py
- **"Access denied"** - проверить Apify токен в .env
- **Бот не отвечает** - проверить процесс и перезапустить

## Последнее обновление
- Дата: 2025-06-30
- Изменения: 
  - Обновлен Apify токен
  - Добавлен месячный лимит на 10 запросов
  - Ограничен размер выборки до 5/7/10 Reels
  - Добавлена логика выбора ближайших Reels если в периоде недостаточно данных