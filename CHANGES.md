# Изменения в Viralinstabot

## Реализованные функции

### 1. Комбинированный поиск рилсов
- **По хештегам**: Бот ищет рилсы в популярных хештегах (#reels, #reelsinstagram, #viral и др.)
- **По описаниям профилей**: Параллельно ищет пользователей по ключевым словам и получает их рилсы
- **Фильтрация по ключевым словам**: Из всех найденных рилсов отбираются только те, в описании которых есть искомые ключевые слова

### 2. Сортировка по лайкам
- Все найденные рилсы сортируются по количеству лайков (самые залайканные первые)
- Это позволяет быстро найти самый популярный контент

### 3. Кликабельные ссылки в PDF
- Все ссылки на рилсы в PDF отчетах теперь кликабельные
- Стиль ссылок: розовый цвет (#D53A87) с подчеркиванием

### 4. Использование MCP Apify
- Все запросы к Instagram идут через Apify MCP
- Используется Instagram Scraper вместо Hashtag Scraper для более широких возможностей

### 5. Обработка ошибок
- Добавлена обработка превышения месячного лимита Apify
- Пользователю показывается понятное сообщение об ошибке

## Как работает поиск

1. Пользователь вводит ключевые слова (например, "coffee recipes")
2. Бот выполняет два параллельных поиска:
   - Получает посты из популярных хештегов
   - Ищет пользователей с этими словами в профиле
3. Из всех найденных постов отбираются только видео/рилсы
4. Проверяется наличие ключевых слов в описании каждого рилса
5. Рилсы сортируются по количеству лайков
6. Топ рилсы включаются в отчет

## Технические детали

- Файл: `src/services/apify_mcp_v2.py`
- Метод поиска: `run_analysis()`
- Сортировка: по полю `likes` в убывающем порядке
- Фильтрация: проверка наличия ключевых слов в поле `caption`
- Лимит результатов: настраивается через `REELS_LIMIT`