# Документация API Apify Instagram Scraper

## Переменные и поля API

### Параметры запроса
- **handles**: Массив имён пользователей Instagram для анализа (без @)
- **hashtags**: Массив хештегов для поиска (без #)
- **directUrls**: Массив прямых URL Instagram для парсинга
- **searchLimit**: Максимальное количество постов для поиска
- **resultsLimit**: Максимальное количество результатов для возврата
- **searchType**: Тип поиска ("hashtag", "user", "location")
- **proxyConfiguration**: Настройки прокси для парсинга

### Поля ответа

#### Основная информация
- **id**: Уникальный идентификатор поста
- **type**: Тип поста ("Reel", "Photo", "Video")
- **shortCode**: Короткий код Instagram для поста
- **url**: Полный URL к посту Instagram
- **timestamp**: ISO временная метка публикации
- **caption**: Полный текст описания поста

#### Метрики вовлечённости
- **likesCount**: Количество лайков
- **commentsCount**: Количество комментариев
- **videoViewCount**: Количество просмотров видео (для Reels)
- **videoPlayCount**: Количество воспроизведений видео
- **videoDuration**: Длительность в секундах

#### Информация об авторе
- **ownerUsername**: Имя пользователя Instagram
- **ownerFullName**: Отображаемое имя
- **ownerId**: Уникальный ID пользователя
- **ownerProfilePicUrl**: URL фото профиля

#### Информация о медиа
- **displayUrl**: Основной URL изображения/миниатюры
- **thumbnailUrl**: Миниатюра для видео/reels
- **videoUrl**: Прямой URL видео (для Reels)
- **images**: Массив URL изображений
- **dimensionsHeight**: Высота медиа в пикселях
- **dimensionsWidth**: Ширина медиа в пикселях

#### Дополнительные данные
- **hashtags**: Массив использованных хештегов
- **mentions**: Массив упомянутых пользователей
- **location**: Информация о локации (если доступна)
- **musicInfo**: Информация о музыке/аудио для Reels
- **isSponsored**: Является ли пост рекламным
- **isPinned**: Закреплён ли пост
- **productType**: Тип продукта Instagram ("clips", "feed" и т.д.)

## Рассчитываемые метрики

### Формула коэффициента вовлечённости (ER)
```
ER = ((лайки + комментарии) / просмотры) × 100
```

Где:
- **лайки**: likesCount из API
- **комментарии**: commentsCount из API  
- **просмотры**: videoViewCount для Reels, или оценка на основе лайков для фото

### Альтернативный расчёт ER (когда известны подписчики)
```
ER = ((лайки + комментарии + репосты) / подписчики) × 100
```

### Средний ER
```
Средний ER = Сумма всех значений ER / Количество постов
```

### Общие метрики
- **Общие просмотры**: Сумма всех значений videoViewCount
- **Общие лайки**: Сумма всех значений likesCount
- **Общие комментарии**: Сумма всех значений commentsCount
- **Средние просмотры**: Общие просмотры / Количество постов

## Примечания по обработке данных

1. **Фильтрация по дате**: Посты фильтруются по timestamp для соответствия запрошенному периоду (3, 7 или 14 дней)
2. **Размер выборки**: Ограничен запрошенным размером выборки (5, 7 или 10 постов)
3. **Сортировка**: Посты сортируются по коэффициенту вовлечённости (по убыванию), чтобы показать наиболее эффективный контент первым
4. **Извлечение хештегов**: Хештеги извлекаются из описания с помощью регулярного выражения `#\w+`
5. **Форматирование URL**: URL Instagram формируются как `https://www.instagram.com/reel/{shortCode}/`

## Обработка ошибок
- Отсутствующие поля обрабатываются значениями по умолчанию
- Резервное значение videoViewCount: используется likesCount * 10 как оценка
- Отсутствующие миниатюры: используется изображение-заполнитель
- Неверные временные метки: используется текущая дата