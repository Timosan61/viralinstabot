# üê≥ Dockerfile Template
#
# –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤ –Ω–∏–∂–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:
# 1. Python –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
# 2. Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ  
# 3. Go –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
# 4. Multi-stage build
#
# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫: Dockerfile

# =====================================================
# üêç PYTHON APPLICATION TEMPLATE
# =====================================================

FROM python:3.11-slim as python-base

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN apt-get update && apt-get install -y \
    curl \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY requirements.txt .

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY . .

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ root –ø—Ä–∞–≤
RUN useradd -m -u 1000 appuser && \
    chown -R appuser:appuser /app
USER appuser

# –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
EXPOSE 8000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
  CMD curl -f http://localhost:8000/health || exit 1

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
CMD ["python", "-m", "src.main"]

# =====================================================
# üü¢ NODE.JS APPLICATION TEMPLATE
# =====================================================

# FROM node:18-alpine as node-base
# 
# # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# RUN apk add --no-cache curl
# 
# WORKDIR /app
# 
# # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ package files
# COPY package*.json ./
# 
# # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# RUN npm ci --only=production && npm cache clean --force
# 
# # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# COPY . .
# 
# # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# USER node
# 
# # –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# EXPOSE 3000
# 
# # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
# HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
#   CMD curl -f http://localhost:3000/health || exit 1
# 
# # –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
# CMD ["npm", "start"]

# =====================================================
# üîµ GO APPLICATION TEMPLATE
# =====================================================

# FROM golang:1.21-alpine AS go-builder
# 
# WORKDIR /app
# 
# # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ go mod files
# COPY go.mod go.sum ./
# RUN go mod download
# 
# # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–±–æ—Ä–∫–∞ –∫–æ–¥–∞
# COPY . .
# RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .
# 
# # –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑
# FROM alpine:latest
# 
# RUN apk --no-cache add ca-certificates curl
# 
# WORKDIR /root/
# 
# # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞ –∏–∑ builder
# COPY --from=go-builder /app/main .
# 
# # –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# EXPOSE 8080
# 
# # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
# HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
#   CMD curl -f http://localhost:8080/health || exit 1
# 
# # –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
# CMD ["./main"]

# =====================================================
# üèó MULTI-STAGE BUILD TEMPLATE (–¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π)
# =====================================================

# # –°—Ç–∞–¥–∏—è —Å–±–æ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# FROM python:3.11-slim as dependencies
# 
# WORKDIR /app
# 
# # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ build –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# RUN apt-get update && apt-get install -y \
#     build-essential \
#     gcc \
#     && rm -rf /var/lib/apt/lists/*
# 
# # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# COPY requirements.txt .
# RUN pip install --user --no-cache-dir -r requirements.txt
# 
# # –°—Ç–∞–¥–∏—è —Å–±–æ—Ä–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# FROM python:3.11-slim as builder
# 
# WORKDIR /app
# 
# # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# COPY --from=dependencies /root/.local /root/.local
# 
# # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
# COPY . .
# 
# # –ö–æ–º–ø–∏–ª—è—Ü–∏—è Python —Ñ–∞–π–ª–æ–≤
# RUN python -m compileall .
# 
# # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω —Å—Ç–∞–¥–∏—è
# FROM python:3.11-slim as production
# 
# # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ runtime –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# RUN apt-get update && apt-get install -y \
#     curl \
#     && rm -rf /var/lib/apt/lists/*
# 
# WORKDIR /app
# 
# # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å—Ç–∞–¥–∏–π
# COPY --from=dependencies /root/.local /root/.local
# COPY --from=builder /app .
# 
# # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ user-installed packages
# ENV PATH=/root/.local/bin:$PATH
# 
# # –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# RUN useradd -m -u 1000 appuser && \
#     chown -R appuser:appuser /app
# USER appuser
# 
# # –ü–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
# EXPOSE 8000
# 
# # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
# HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
#   CMD curl -f http://localhost:8000/health || exit 1
# 
# # –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
# CMD ["python", "-m", "src.main"]

# =====================================================
# üìã BEST PRACTICES CHECKLIST
# =====================================================
#
# ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ç–µ–≥–∏ –æ–±—Ä–∞–∑–æ–≤ (–Ω–µ latest)
# ‚úÖ –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ root –ø—Ä–∞–≤
# ‚úÖ –£–¥–∞–ª—è–π—Ç–µ –Ω–µ–Ω—É–∂–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –∏ –∫—ç—à
# ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .dockerignore —Ñ–∞–π–ª
# ‚úÖ –î–æ–±–∞–≤–ª—è–π—Ç–µ HEALTHCHECK
# ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ EXPOSE –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
# ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ multi-stage builds –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
# ‚úÖ –ö–æ–ø–∏—Ä—É–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –∫–æ–¥–∞ (–¥–ª—è –ª—É—á—à–µ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
# ‚úÖ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
# ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WORKDIR –≤–º–µ—Å—Ç–æ cd

# =====================================================
# üìÑ .dockerignore TEMPLATE
# =====================================================
#
# –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .dockerignore –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
#
# # Git
# .git
# .gitignore
# README.md
# 
# # Documentation
# docs/
# *.md
# 
# # Dependencies
# node_modules/
# venv/
# __pycache__/
# *.pyc
# 
# # IDE
# .vscode/
# .idea/
# *.swp
# *.swo
# 
# # OS
# .DS_Store
# Thumbs.db
# 
# # Logs
# *.log
# logs/
# 
# # Testing
# .coverage
# .pytest_cache/
# test_reports/
# 
# # Build artifacts
# dist/
# build/
# target/
# 
# # Environment
# .env
# .env.local
# .env.*.local
# 
# # Temporary
# tmp/
# temp/